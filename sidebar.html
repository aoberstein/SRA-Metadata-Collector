<!DOCTYPE html>
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
<html>
  <head>
  <title>Reannotator</title>
  <script>
  function formSubmit() {
       updateStatus('Submitted.');
       var response = {
       accessions:document.getElementById('accessions').value.split('\n'),
       parameters:{save_pref:document.getElementById('save-pref').checked}};
       response = validateResponse(response);
       if(response != null) {validSubmit(response);}
  }
  function validateResponse(response) {
    if(response.accessions[0]=="") {updateStatus('Please enter accessions or SRA search terms for sequencing studies.');
      return;}
    var blankEntries = [];
    for (var i = 0; i < response.accessions.length; i++) {
     if (response.accessions[i]=='') {
       blankEntries.push(i);
       }
     }
    for (var i=0; i < blankEntries.length; i++) {
        response.accessions.splice(blankEntries[i]-i,1);
        }
    return response
}
  function validSubmit(response) {
  updateStatus('Accessions accepted. Gathering Metadata.');
  google.script.run.withFailureHandler(updateStatus)
                   .withSuccessHandler(updateStatus)
                   .getMetadataRequest(response);
  }
  function updateStatus(s) {
        var div = document.getElementById('output');
        div.innerHTML = '<p><span class="current">'+s+'</span></p>';
      }
     </script>
     <base target="_top">
  </head>
  
  <body>
      <div class="sidebar branding-below">
      <div class="block form-group">
         <label for="accessions">
           <b>Accessions</b><br>
           Please enter new-line delimited SRA, Bioproject, or GEO study accessions with associated sequencing runs in SRA. Alternatively, enter SRA search terms.</label>
         <textarea id="accessions" rows="15"></textarea>
       </div>
 <div class="block">
 <input type="checkbox" id="save-pref">
  <label for="checkbox">Save to separate sheets?</label>

 </div>
 <div class="block">
    <button class="blue" onclick='formSubmit()'>Submit</button>
  </div>
  <div id="output"></div>
</div>  
   <div class="sidebar bottom">
     <? var key = getKey_();
     if(key==null){key="not set";}?>
     <span class="secondary"><em>ncbi</em> API key: <?= key ?>.</span>
     <? var retmax = getRetmax_();
     if(retmax==null){retmax="not set";}?>
     <span class="secondary"><em>ncbi</em> retmax: <?= retmax ?>.</span>
   </div>
  </body>
</html>
